<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Patient Registration</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: 
        /* Dark overlay for contrast */
        linear-gradient(rgba(250, 250, 255, 0.925), rgba(253, 253, 255, 0.9)),
        /* Medical background image */
        url('https://images.unsplash.com/photo-1581595219315-a187dd40c322?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80') center/cover;
      color: #e0e0e0;
      min-height: 100vh;
    }
    .input {
      width: 100%;
      padding: 12px 16px;
      margin-top: 8px;
      background: rgba(45, 45, 45, 0.8);
      border: 2px solid #3a3a3a;
      border-radius: 10px;
      color: #ffffff;
      transition: all 0.3s ease;
    }
    .input:focus {
      border-color: #dc3545;
      outline: none;
      box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.2);
      background: rgba(51, 51, 51, 0.9);
    }
    .card {
      background: rgba(37, 37, 37, 0.9);
      padding: 2rem;
      border-radius: 16px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
      border-left: 4px solid #dc3545;
      margin-bottom: 1.5rem;
      backdrop-filter: blur(4px);
    }
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      padding: 8px 0;
    }
    input[type="checkbox"] {
      width: 18px;
      height: 18px;
      accent-color: #dc3545;
    }
    textarea.input {
      min-height: 100px;
      resize: vertical;
    }
    select.input {
    appearance: none;
    background-color: #f0f0f0; /* Light grey background */
    color: #333; /* Dark grey text */
    border: 1px solid #d1d1d1; /* Light grey border */
    border-radius: 4px;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    font-family: Arial, sans-serif;
    background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='pink'%3e%3cpath d='M7 10l5 5 5-5z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1em;
    transition: background-color 0.3s ease;
}

select.input:hover {
    background-color: #e0e0e0; /* Slightly darker grey on hover */
    border-color: #d8d8d8; /* Light grey border on hover */
}

select.input:focus {
    background-color: #fce4ec; /* Light pink when focused */
    border-color: #f48fb1; /* Pink border on focus */
    outline: none;
}

    .readonly-input {
      background: rgba(60, 60, 60, 0.8) !important;
      color: #cccccc !important;
      cursor: not-allowed;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      overflow-y: auto;
    }
    .modal-content {
      background: rgba(37, 37, 37, 0.95);
      margin: 5% auto;
      padding: 2rem;
      border-radius: 16px;
      width: 80%;
      max-width: 800px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
      border-left: 4px solid #dc3545;
    }
    .close-modal {
      color: #aaa;
      float: right;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close-modal:hover {
      color: #fff;
    }
    .data-display {
      background: rgba(60, 60, 60, 0.8);
      padding: 1.5rem;
      border-radius: 10px;
      margin-top: 1rem;
    }
    .data-item {
      margin-bottom: 0.8rem;
      padding-bottom: 0.8rem;
      border-bottom: 1px solid #444;
    }
    .data-label {
      font-weight: 600;
      color: #dc3545;
      display: inline-block;
      width: 180px;
    }
    .data-value {
      color: #e0e0e0;
    }
  </style>
</head>
<body class="py-12 px-4">
  <div class="max-w-5xl mx-auto space-y-10">
    <h2 class="text-4xl font-Sauvage text-center text-black">
      <span class="text-red-500"></span> Patient Registration Form
      <span class="text-red-500"></span>
    </h2>

    <form id="patientForm" class="space-y-8">

      <!-- Patient Details -->
      <div class="card">
        <h3 class="text-2xl font-semibold text-white mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
          </svg>
          Patient Details
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="text-gray-300">Patient ID</label>
            <input type="text" name="pid" placeholder="Enter patient ID" required class="input" />
          </div>
          <div>
            <label class="text-gray-300">First Name</label>
            <input type="text" name="fname" placeholder="Enter first name" required class="input" />
          </div>
          <div>
            <label class="text-gray-300">Last Name</label>
            <input type="text" name="lname" placeholder="Enter last name" required class="input" />
          </div>
          <div>
            <label class="text-gray-300">Age</label>
            <input type="number" name="age" placeholder="Enter age" required class="input" />
          </div>
          <div>
            <label class="text-gray-300">Date of Birth</label>
            <input type="date" name="dob" required class="input" />
          </div>
          <div>
            <label class="text-gray-300">Gender</label>
            <select name="gender" class="input" required>
              <option value="">Select gender</option>
              <option value="Male">Male</option>
              <option value="Female">Female</option>
              <option value="Other">Other</option>
              <option value="Prefer not to say">Prefer not to say</option>
            </select>
          </div>
          <div>
            <label class="text-gray-300">Address</label>
            <input type="text" name="address" placeholder="Enter address" class="input" />
          </div>
          <div>
            <label class="text-gray-300">Contact</label>
            <input type="text" name="contact" placeholder="Enter contact" class="input" />
          </div>
          <div>
            <label class="text-gray-300">email</label>
            <input type="text" name="email" placeholder="Enter email" required class="input" />
          </div>
        </div>
      </div>

      <!-- Lifestyle -->
      <div class="card">
        <h3 class="text-2xl font-semibold text-white mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
          </svg>
          Lifestyle Factors
        </h3>
        <div class="grid grid-cols-1 gap-4">
          <label class="checkbox-label">
            <input type="checkbox" name="smoking_status" />
            <span class="text-gray-300"> Smoking</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="alcohol_consumption" />
            <span class="text-gray-300"> Alcohol Consumption</span>
          </label>
          <label class="checkbox-label">
            <input type="checkbox" name="drug_intake" />
            <span class="text-gray-300"> Drug Use</span>
          </label>
          <div>
            <label for="physical_activity">Physical Activity Level:</label>
            <select id="physical_activity" name="physical_activity" required class="input">
              <option value="">--Select--</option>
              <option value="Sedentary">Sedentary (little or no exercise)</option>
              <option value="Lightly Active">Lightly Active (light exercise/sports 1-3 days/week)</option>
              <option value="Moderately Active">Moderately Active (moderate exercise/sports 3-5 days/week)</option>
              <option value="Very Active">Very Active (hard exercise/sports 6-7 days/week)</option>
              <option value="Super Active">Super Active (very hard exercise & physical job)</option>
            </select>
            
          </div>
          <div>
            <label for="diet_preferences">Diet Preferences:</label>
            <select id="diet_preferences" name="diet_preferences" required class="input">
              <option value="">--Select--</option>
              <option value="Vegetarian">Vegetarian</option>
              <option value="Non-Vegetarian">Non-Vegetarian</option>
              <option value="Vegan">Vegan</option>
              <option value="Pescatarian">Pescatarian (fish eater)</option>
              <option value="Keto">Keto</option>
              <option value="Other">Other</option>
            </select>
            
          </div>
        </div>
      </div>

      <!-- Emergency -->
      <div class="card">
        <h3 class="text-2xl font-semibold text-white mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
          Emergency Information
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="text-gray-300">Emergency Contact Name</label>
            <input type="text" name="ename" placeholder="Enter emergency contact name" class="input" />
          </div>
          <div>
            <label class="text-gray-300">Emergency Contact</label>
            <input type="text" name="emergency_contact" placeholder="Enter emergency contact" class="input" />
          </div>
          <div>
            <label class="text-gray-300">Preferred Hospital</label>
            <select name="preferredHospital" id="hospitalDropdown" class="input">
              <option value="">Select a hospital</option>
              <!-- Options will be populated by JavaScript -->
            </select>
          </div>
          <div>
            <label class="text-gray-300">Hospital Contact</label>
            <input type="text" name="HOSNO" id="hospitalContact" placeholder="Auto-filled based on selection" class="input readonly-input" readonly />
          </div>
         
        </div>
      </div>

      <!-- Doctor Info -->
      <div class="card">
        <h3 class="text-2xl font-semibold text-white mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Assigned Doctor
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="text-gray-300">Doctor</label>
            <select name="did" id="doctorDropdown" class="input" required>
              <option value="">Select a doctor</option>
              <!-- Options will be populated by JavaScript -->
            </select>
          </div>
          <div>
            <label class="text-gray-300">Doctor Contact</label>
            <input type="text" name="DCONTACT" id="doctorContact" placeholder="Auto-filled based on selection" class="input readonly-input" readonly />
          </div>
          <div>
            <label class="text-gray-300">Hospital Name</label>
            <input type="text" name="HNAME" id="doctorHospital" placeholder="Auto-filled based on selection" class="input readonly-input" readonly />
          </div>
        
        </div>
      </div>

      <!-- Medical Info -->
      <div class="card">
        <h3 class="text-2xl font-semibold text-white mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Medical Information
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="text-gray-300">Body Weight (kg)</label>
            <input type="number" name="bodyweight" placeholder="Enter weight in kg" class="input" id="bodyweight" />
          </div>
          <div>
            <label class="text-gray-300">Height (cm)</label>
            <input type="number" name="height" placeholder="Enter height in cm" class="input" id="height" />
          </div>
          <div>
            <label class="text-gray-300">BMI</label>
            <input type="number" step="0.01" name="bmi" placeholder="Auto-calculated" class="input bg-gray-800" id="bmi" readonly />
          </div>
          <div>
            <label for="cholestrol">Cholesterol:</label>
            <input type="number" id="cholestrol" name="cholestrol" min="0" max="180" required>
            
          </div>
          <div>
            <label for="bloodtype">Blood Type:</label>
            <select name="bloodtype" id="bloodtype" required>
              <option value="">Select Blood Type</option>
              <option value="A+">A+</option>
              <option value="A-">A-</option>
              <option value="B+">B+</option>
              <option value="B-">B-</option>
              <option value="AB+">AB+</option>
              <option value="AB-">AB-</option>
              <option value="O+">O+</option>
              <option value="O-">O-</option>
            </select>
            
          </div>
          <div>
            <label class="text-gray-300">Blood pressure</label>
            <input type="text" name="blood_pressure" placeholder="Enter blood pressure" class="input" />
          </div>
          <div>
            <label for="diabetes">Diabetes:</label>
            <select name="diabetes" id="diabetes" class="input">
              <option value="None">None</option>
              <option value="Type 1">Type 1</option>
              <option value="Type 2">Type 2</option>
              <option value="Gestational">Gestational</option>
            </select>
            
          </div>
        </div>
      </div>

      <!-- Cardiac Information -->
      <div class="card">
        <h3 class="text-2xl font-semibold text-white mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
          </svg>
          Cardiac Information
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <label class="text-gray-300">Percentage of Heart Block</label>
            <input type="number" name="heart_block_percentage" placeholder="Enter percentage (0-100)" min="0" max="100" class="input" />
          </div>
          <div>
            <label class="text-gray-300">Type of Heart Attack</label>
            <select name="heart_attack_type" class="input">
              <option value="">Select type</option>
              <option value="STEMI">STEMI (ST-elevation myocardial infarction)</option>
              <option value="NSTEMI">NSTEMI (Non-ST-elevation myocardial infarction)</option>
              <option value="Silent">Silent Ischemia</option>
              <option value="Coronary">Coronary Artery Spasm</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label class="text-gray-300">Date of Surgery</label>
            <input type="date" name="surgery_date" class="input" />
            
          </div>
          <div>
            <label class="text-gray-300">previous_attack_history</label>
            <input type="text" name="prevattack_history" placeholder="Enter previous attack history" class="input" />
            
          </div>
          <div>
            <label class="text-gray-300">heart rate</label>
            <input type="text" name="heartrate" placeholder="Enter heart rate" class="input" />
            
          </div>
        </div>
      </div>

      <!-- History -->
      <div class="card">
        <h3 class="text-2xl font-semibold text-white mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
          Patient History
        </h3>
       
        <div>
          <label class="text-gray-300">Medical History</label>
          <textarea name="medical_history" placeholder="Enter medical history" class="input mb-4" rows="3"></textarea>
        </div>
        <div>
          <label class="text-gray-300">Family History</label>
          <textarea name="family_history" placeholder="Enter family history" class="input" rows="3"></textarea>
        </div>
      </div>

      <!-- Treatment -->
      <div class="card">
        <h3 class="text-2xl font-semibold text-white mb-6 flex items-center gap-3">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
          </svg>
          Treatment Plan
        </h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="text-gray-300">Treatment Plan</label>
            <input type="text" name="treatment_plan" placeholder="Enter treatment plan" class="input" />
          </div>
          <div>
            <label class="text-gray-300">Monitoring Data</label>
            <input type="text" name="monitoring_data" placeholder="Enter monitoring data" class="input" />
          </div>
          <div>
            <label class="text-gray-300">Surgery Details</label>
            <input type="text" name="surgery_details" placeholder="Enter surgery details" class="input" />
          </div>
        </div>
      </div>

      <!-- Submit -->
      <div class="text-center">
        <button type="submit" class="px-10 py-4 bg-gradient-to-r from-red-600 to-red-800 text-white text-lg font-bold rounded-full shadow-lg hover:from-red-700 hover:to-red-900 transition duration-300 transform hover:scale-105 hover:shadow-xl">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 inline mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
          Submit Patient Data
        </button>
      </div>

      <div id="responseMsg" class="mt-6 text-center text-base font-medium"></div>
    </form>
  </div>

  <!-- Modal for displaying submitted data -->
  <div id="submittedDataModal" class="modal">
    <div class="modal-content">
      <span class="close-modal">&times;</span>
      <h2 class="text-2xl font-bold text-white mb-4">Submitted Patient Data</h2>
      <div id="submittedDataDisplay" class="data-display">
        <!-- Data will be displayed here -->
      </div>
    </div>
  </div>

  <script>
    // Doctor data from your table
    const doctors = [
      { id: 1, name: "Dr. Anil Mehta", contact: "9876543210", hospitalId: "H001", hospital: "Apollo Hospital" },
      { id: 2, name: "Dr. Ritu Sharma", contact: "9876543211", hospitalId: "H002", hospital: "Fortis Healthcare" },
      { id: 3, name: "Dr. Vikram Patel", contact: "9876543212", hospitalId: "H003", hospital: "AIIMS Delhi" },
      { id: 4, name: "Dr. Neha Bansal", contact: "9876543213", hospitalId: "H004", hospital: "Max Hospital" },
      { id: 5, name: "Dr. Arjun Rao", contact: "9876543214", hospitalId: "H005", hospital: "Medanta Medicity" },
      { id: 6, name: "Dr. Priya Nair", contact: "9876543215", hospitalId: "H006", hospital: "Columbia Asia" },
      { id: 7, name: "Dr. Karan Gupta", contact: "9876543216", hospitalId: "H007", hospital: "Narayana Health" },
      { id: 8, name: "Dr. Meera Joshi", contact: "9876543217", hospitalId: "H008", hospital: "Lilavati Hospital" },
      { id: 9, name: "Dr. Rajeev Das", contact: "9876543218", hospitalId: "H009", hospital: "Kokilaben Hospital" },
      { id: 10, name: "Dr. Sneha Iyer", contact: "9876543219", hospitalId: "H010", hospital: "Manipal Hospital" },
      { id: 11, name: "Dr. Suresh Kumar", contact: "9876543220", hospitalId: "H011", hospital: "Ruby Hall Clinic" },
      { id: 12, name: "Dr. Ananya Sen", contact: "9876543221", hospitalId: "H012", hospital: "Care Hospitals" },
      { id: 13, name: "Dr. Imran Qureshi", contact: "9876543222", hospitalId: "H013", hospital: "Sunshine Hospital" },
      { id: 14, name: "Dr. Kavita Menon", contact: "9876543223", hospitalId: "H014", hospital: "Cloudnine Hospital" },
      { id: 15, name: "Dr. Nikhil Jain", contact: "9876543224", hospitalId: "H015", hospital: "Sir Ganga Ram Hospital" },
      { id: 16, name: "Dr. Pooja Mishra", contact: "9876543225", hospitalId: "H016", hospital: "Jehangir Hospital" },
      { id: 17, name: "Dr. Ashok Verma", contact: "9876543226", hospitalId: "H017", hospital: "Tata Memorial Hospital" },
      { id: 18, name: "Dr. Radhika Shetty", contact: "9876543227", hospitalId: "H018", hospital: "Saifee Hospital" },
      { id: 19, name: "Dr. Harsh Singh", contact: "9876543228", hospitalId: "H019", hospital: "Breach Candy Hospital" },
      { id: 20, name: "Dr. Alok Bhatt", contact: "9876543229", hospitalId: "H020", hospital: "Hinduja Hospital" }
    ];

    // Hospital data from your table
    const hospitals = [
      { id: "H001", name: "Apollo Hospital", contact: "011-2223344", location: "Delhi, India" },
      { id: "H002", name: "Fortis Healthcare", contact: "011-2233445", location: "Gurgaon, India" },
      { id: "H003", name: "AIIMS Delhi", contact: "011-2233446", location: "Delhi, India" },
      { id: "H004", name: "Max Hospital", contact: "011-2233447", location: "Noida, India" },
      { id: "H005", name: "Medanta Medicity", contact: "011-2233448", location: "Gurgaon, India" },
      { id: "H006", name: "Columbia Asia", contact: "011-2233449", location: "Bangalore, India" },
      { id: "H007", name: "Narayana Health", contact: "011-2233450", location: "Bangalore, India" },
      { id: "H008", name: "Lilavati Hospital", contact: "011-2233451", location: "Mumbai, India" },
      { id: "H009", name: "Kokilaben Hospital", contact: "011-2233452", location: "Mumbai, India" },
      { id: "H010", name: "Manipal Hospital", contact: "011-2233453", location: "Bangalore, India" },
      { id: "H011", name: "Ruby Hall Clinic", contact: "011-2233454", location: "Pune, India" },
      { id: "H012", name: "Care Hospitals", contact: "011-2233455", location: "Hyderabad, India" },
      { id: "H013", name: "Sunshine Hospital", contact: "011-2233456", location: "Hyderabad, India" },
      { id: "H014", name: "Cloudnine Hospital", contact: "011-2233457", location: "Chennai, India" },
      { id: "H015", name: "Sir Ganga Ram Hospital", contact: "011-2233458", location: "Delhi, India" },
      { id: "H016", name: "Jehangir Hospital", contact: "011-2233459", location: "Pune, India" },
      { id: "H017", name: "Tata Memorial Hospital", contact: "011-2233460", location: "Mumbai, India" },
      { id: "H018", name: "Saifee Hospital", contact: "011-2233461", location: "Mumbai, India" },
      { id: "H019", name: "Breach Candy Hospital", contact: "011-2233462", location: "Mumbai, India" },
      { id: "H020", name: "Hinduja Hospital", contact: "011-2233463", location: "Mumbai, India" }
    ];

    // Modal functionality
    const modal = document.getElementById("submittedDataModal");
    const closeModal = document.querySelector(".close-modal");
    
    closeModal.addEventListener("click", function() {
      modal.style.display = "none";
    });
    
    window.addEventListener("click", function(event) {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });

    // Function to display submitted data in modal
    function displaySubmittedData(formData) {
      const dataDisplay = document.getElementById("submittedDataDisplay");
      dataDisplay.innerHTML = "";
      
      // Create a display object with formatted labels
      const displayData = {
        "Patient ID": formData.get("pid"),
        "Name": `${formData.get("fname")} ${formData.get("lname")}`,
        "Age": formData.get("age"),
        "Date of Birth": formData.get("dob"),
        "Gender": formData.get("gender"),
        "Address": formData.get("address"),
        "Contact": formData.get("contact"),
        "Lifestyle Factors": [
          formData.get("smoking_status") ? "Smoking" : null,
          formData.get("alcohol_consumption") ? "Alcohol Consumption" : null,
          formData.get("drug_intake") ? "Drug Use" : null
        ].filter(Boolean).join(", ") || "None",
        "Physical Activity": formData.get("physical_activity"),
        "Diet Preferences": formData.get("diet_preferences"),
        "Emergency Contact": formData.get("emergency_contact"),
        "Preferred Hospital": hospitals.find(h => h.id === formData.get("preferredHospital"))?.name || "Not specified",
        "Assigned Doctor": doctors.find(d => d.id == formData.get("did"))?.name || "Not specified",
        "Doctor Contact": formData.get("DCONTACT"),
        "Doctor's Hospital": formData.get("HNAME"),
        "Medical Information": [
          `Weight: ${formData.get("bodyweight")} kg`,
          `Height: ${formData.get("height")} cm`,
          `BMI: ${formData.get("bmi")}`,
          `Blood Type: ${formData.get("bloodtype")}`,
          `Cholestrol: ${formData.get("cholestrol")}`,
          `Blood Pressure:${formData.get("blood_pressure")}`,
          `Diabetes:${formData.get("diabetes")}`

        ].join(", "),
        "Cardiac Information": [
          `Heart Block: ${formData.get("heart_block_percentage") || '0'}%`,
          `Heart Attack Type: ${formData.get("heart_attack_type") || 'Not specified'}`,
          `Surgery Date: ${formData.get("surgery_date") || 'Not specified'}`,
           `previous heart attack history: ${formData.get("prevattack_history") || 'Not specified'}`,
           `Heart rate:${formData.get("heartrate")}`
        ].join(", "),
        "Medical History": formData.get("medical_history") || "None provided",
        "Family History": formData.get("family_history") || "None provided",
        "Treatment Plan": formData.get("treatment_plan") || "Not specified",
        "Monitoring Data": formData.get("monitoring_data") || "Not specified",
        "Surgery Details": formData.get("surgery_details") || "Not specified"
      };
      
      // Add each data item to the display
      for (const [label, value] of Object.entries(displayData)) {
        if (value) {
          const itemDiv = document.createElement("div");
          itemDiv.className = "data-item";
          itemDiv.innerHTML = `
            <span class="data-label">${label}:</span>
            <span class="data-value">${value}</span>
          `;
          dataDisplay.appendChild(itemDiv);
        }
      }
      
      // Show the modal
      modal.style.display = "block";
    }

    // Populate dropdowns on page load
    document.addEventListener('DOMContentLoaded', function() {
      const doctorDropdown = document.getElementById('doctorDropdown');
      const hospitalDropdown = document.getElementById('hospitalDropdown');
      
      // Populate doctor dropdown
      doctors.forEach(doctor => {
        const option = document.createElement('option');
        option.value = doctor.id;
        option.textContent = `${doctor.id} - ${doctor.name} (${doctor.hospital})`;
        option.setAttribute('data-hospital-id', doctor.hospitalId);
        doctorDropdown.appendChild(option);
      });
      
      // Populate hospital dropdown
      hospitals.forEach(hospital => {
        const option = document.createElement('option');
        option.value = hospital.id;
        option.textContent = `${hospital.id} - ${hospital.name} (${hospital.location})`;
        hospitalDropdown.appendChild(option);
      });
    });

    // Update doctor-related fields when selection changes
    document.getElementById('doctorDropdown').addEventListener('change', function() {
      const selectedId = this.value;
      const doctorContact = document.getElementById('doctorContact');
      const doctorHospital = document.getElementById('doctorHospital');
      const doctorHospitalLocation = document.getElementById('doctorHospitalLocation');
      
      if (selectedId) {
        const selectedDoctor = doctors.find(d => d.id == selectedId);
        if (selectedDoctor) {
          doctorContact.value = selectedDoctor.contact;
          doctorHospital.value = selectedDoctor.hospital;
          
          // Find and display hospital details
          const doctorHospitalData = hospitals.find(h => h.id === selectedDoctor.hospitalId);
          if (doctorHospitalData) {
            doctorHospitalLocation.value = doctorHospitalData.location;
          }
        }
      } else {
        doctorContact.value = '';
        doctorHospital.value = '';
        doctorHospitalLocation.value = '';
      }
    });

    // Update hospital fields when hospital selection changes
    document.getElementById('hospitalDropdown').addEventListener('change', function() {
      const selectedId = this.value;
      const hospitalContact = document.getElementById('hospitalContact');
      const hospitalLocation = document.getElementById('hospitalLocation');
      
      if (selectedId) {
        const selectedHospital = hospitals.find(h => h.id == selectedId);
        if (selectedHospital) {
          hospitalContact.value = selectedHospital.contact;
          hospitalLocation.value = selectedHospital.location;
        }
      } else {
        hospitalContact.value = '';
        hospitalLocation.value = '';
      }
    });

    const weightInput = document.getElementById("bodyweight");
    const heightInput = document.getElementById("height");
    const bmiInput = document.getElementById("bmi");

    function calculateBMI() {
      const weight = parseFloat(weightInput.value);
      const height = parseFloat(heightInput.value);
      if (!isNaN(weight) && !isNaN(height) && height > 0) {
        const bmi = (weight / ((height / 100) ** 2)).toFixed(2);
        bmiInput.value = bmi;
      } else {
        bmiInput.value = "";
      }
    }

    weightInput.addEventListener("input", calculateBMI);
    heightInput.addEventListener("input", calculateBMI);

    document.getElementById("patientForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const formData = new FormData(this);

      const response = await fetch("/submit", {
        method: "POST",
        body: formData
      });

      const result = await response.json();
      const msg = document.getElementById("responseMsg");
      
      if (response.ok) {
        msg.textContent = "✅ Data submitted successfully! PID: " + result.pid;
        msg.className = "text-green-500";
        this.reset();
        bmiInput.value = "";
      } else {
        msg.textContent = "❌ Error: " + result.error;
        msg.className = "text-red-500";
      }

      // Display modal summary
      displaySubmittedData(formData);
    });
  </script>
</body>
</html>
